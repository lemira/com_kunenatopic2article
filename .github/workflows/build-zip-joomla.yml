name: Build Joomla Package # Строка 1 (Опционально, но лучше оставить)
on: # Строка 2 (ОБЯЗАТЕЛЬНО)
  workflow_dispatch:
  push:
    branches: [ interface ]

jobs: # ОБЯЗАТЕЛЬНО
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: interface

      - name: Set timestamp (Berlin time)
        run: echo "TIMESTAMP=$(TZ=Europe/Berlin date +'%y%m%d-%H%M')" >> $GITHUB_ENV

      - name: Build clean Joomla package ZIP (FINAL FIX) ✅
        run: |
          ARCHIVE_NAME="com_kunenatopic2article_${{ env.TIMESTAMP }}.zip"
          
          # Переходим в директорию, где лежат все файлы пакета
          cd ${{ github.workspace }}
          
          # Архивируем содержимое: папки admin и media, 
          # и файл kunenatopic2article.xml. 
          # В этом режиме zip добавит их в корень архива.
          zip -r $ARCHIVE_NAME admin media kunenatopic2article.xml
          
          # Перемещаем готовый архив на уровень выше, 
          # чтобы actions/upload-artifact мог его найти.
          mv $ARCHIVE_NAME ..
